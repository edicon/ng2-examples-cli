{"version":3,"file":"waveform.component.js","sourceRoot":"","sources":["waveform.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit, Output, ChangeDetectionStrategy, ChangeDetectorRef, ElementRef, EventEmitter } from '@angular/core';\nimport { MediaService } from '../../services/media-service';\nimport { Meter } from '../../models/meter';\n\ndeclare let d3:any;\ndeclare let module: any;\n\n\n@Component({\nselector: 'waveform-monitor',\nmoduleId: module.id,\ntemplateUrl: 'waveform.component.html',\nstyleUrls: ['waveform.component.css'],\nproviders: [MediaService]\n})\n\nexport class WaveformComponent implements OnInit {\n\n  elem: any;\n  mediaService: MediaService;\n  width: number;\n  height: number;\n  color: string;\n  meters: any[];\n  data: number[];\n  shape: any;\n  selected: number;\n  init: boolean;\n  isVisible: boolean;\n  ref: ChangeDetectorRef;\n  controls: EventEmitter<any>;\n\n  @Output() path: any;\n\n  constructor(mediaService: MediaService, ref: ChangeDetectorRef, elem: ElementRef) {\n\n    this.init = false;\n    this.mediaService = mediaService;\n    this.elem = elem;\n    this.ref = ref;\n    this.color = '#8DE969';\n    this.width = window.innerWidth;\n    this.height = 240;\n    this.data = [];\n    this.meters = [];\n    this.newMeter();\n    this.isVisible = false;\n    this.controls = new EventEmitter();\n  }\n\n  ngOnInit() {\n\n    var x = d3.scale.linear().domain([0, 512]).range([0, window.innerWidth]),\n        y = d3.scale.linear().domain([0, 255]).range([this.height, 0]),\n        line = d3.svg.line()\n            .interpolate('basis')\n            .x(function(d, i) { return x(i); })\n            .y(function(d, i) { return y(d); });\n\n    this.shape = this.elem.nativeElement.getElementsByClassName('levels')[0];\n\n    this.mediaService.emitter.subscribe((res)=>{\n\n      this.data = res;\n      res.unshift(0);\n      res.push(0);\n\n      this.path = line(res);\n\n      if(this.meters.length > 0) {\n\n        for( let i=0; i < this.meters.length; i++ ) {\n\n          //this.meters[i].level.points[0].y = this.height - this.shape.getPointAtLength(this.meters[i].position.x).y;\n\n          //this.meters[i].val = this.scale(this.meters[i].level.points[0].y, this.height, 0, 0, 255);\n          this.meters[i].val = this.data[this.scale(this.meters[i].position.x, 0, window.innerWidth, 0, 1024)];\n          this.meters[i].transform = 'translate('+ this.meters[i].position.x+', 0)';\n          this.meters[i].level.points[0].y = this.height - this.scale(this.meters[i].val, 0, 255, 0, this.height);\n\n\n        }\n\n        this.controls.emit({\n          meters: this.meters\n        });\n\n        this.ref.detectChanges();\n\n      }\n\n\n      //console.log(this.meters[0].val);\n\n\n\n    });\n\n\n\n  }\n\n  // ngOnDestroy() {\n  //   this.mediaService.emitter.unsubscribe();\n  // }\n\n  onMouseMove(ev) {\n\n    if(this.selected !== 1000) {\n      this.meters[this.selected].position.x = ev.clientX;\n      //this.ref.detectChanges();\n    }\n\n  }\n  onMouseLeave(ev) {\n\n    // this.playhead.isVisible = false;\n    // this.ref.detectChanges();\n\n  }\n\n  scale(v, min, max, gmin, gmax) {\n\n      v = parseInt(v);\n      return parseInt(((v - min) / (max - min)) * (gmax - gmin) + gmin);\n\n   }\n\n    newMeter() {\n\n     this.meters.push(new Meter(this.height, this.meters.length));\n     this.selected = this.meters.length - 1;\n\n   }\n\n   addMeter() {\n\n     if(!this.init) {\n       this.isVisible = true;\n       this.init = true;\n     } else {\n      this.meters.push(new Meter(this.height, this.meters.length));\n      this.selected = this.meters.length - 1;\n     }\n\n   }\n\n   hideMeters() {\n     this.isVisible = false;\n   }\n\n   showMeters() {\n    this.isVisible = true;\n   }\n\n   onMeterClick(ev, meter) {\n\n     if(this.selected === meter.index) {\n       this.selected = 1000;\n     } else {\n       this.selected = meter.index;\n     }\n\n   }\n\n\n\n}\n"]}